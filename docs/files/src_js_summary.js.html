<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\js\summary.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ColorSwitcher.html">ColorSwitcher</a></li>
                                <li><a href="../classes/Comment.html">Comment</a></li>
                                <li><a href="../classes/comment.js_anonymous.html">comment.js_anonymous</a></li>
                                <li><a href="../classes/Data.html">Data</a></li>
                                <li><a href="../classes/Global.html">Global</a></li>
                                <li><a href="../classes/helpInfo.js_anonymous.html">helpInfo.js_anonymous</a></li>
                                <li><a href="../classes/IO.html">IO</a></li>
                                <li><a href="../classes/io.js_anonymous.html">io.js_anonymous</a></li>
                                <li><a href="../classes/JQuery.html">JQuery</a></li>
                                <li><a href="../classes/ManualMarkup.html">ManualMarkup</a></li>
                                <li><a href="../classes/manualMarkup.js_anonymous.html">manualMarkup.js_anonymous</a></li>
                                <li><a href="../classes/navbar.js_anonymous.html">navbar.js_anonymous</a></li>
                                <li><a href="../classes/Regex.html">Regex</a></li>
                                <li><a href="../classes/Summary.html">Summary</a></li>
                                <li><a href="../classes/summary.js_anonymous.html">summary.js_anonymous</a></li>
                                <li><a href="../classes/switcher.js_anonymous.html">switcher.js_anonymous</a></li>
                                <li><a href="../classes/tagRegex.js_anonymous.html">tagRegex.js_anonymous</a></li>
                                <li><a href="../classes/UI.html">UI</a></li>
                                <li><a href="../classes/ui.js_anonymous.html">ui.js_anonymous</a></li>
                                <li><a href="../classes/Util.html">Util</a></li>
                                <li><a href="../classes/utilities.js_anonymous.html">utilities.js_anonymous</a></li>
                                <li><a href="../classes/WebDictionary.html">WebDictionary</a></li>
                                <li><a href="../classes/webDictionary.js_anonymous.html">webDictionary.js_anonymous</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/comment.js.html">comment.js</a></li>
                                <li><a href="../modules/data.js.html">data.js</a></li>
                                <li><a href="../modules/helpInfo.js.html">helpInfo.js</a></li>
                                <li><a href="../modules/io.js.html">io.js</a></li>
                                <li><a href="../modules/markus.js.html">markus.js</a></li>
                                <li><a href="../modules/navbar.js.html">navbar.js</a></li>
                                <li><a href="../modules/reference.js.html">reference.js</a></li>
                                <li><a href="../modules/summary.js.html">summary.js</a></li>
                                <li><a href="../modules/switcher.js.html">switcher.js</a></li>
                                <li><a href="../modules/tagRegex.js.html">tagRegex.js</a></li>
                                <li><a href="../modules/ui.js.html">ui.js</a></li>
                                <li><a href="../modules/utilities.js.html">utilities.js</a></li>
                                <li><a href="../modules/webDictionary.js.html">webDictionary.js</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\js\summary.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * summary.js base file.
 * @module summary.js
 */

 /**
 The class that holds the variables and functions created in the namespace of this file.
 The constrcutor of this object is only called once, because it is an anonymous function.

 @class summary.js_anonymous
 @constructor
 @param {Object}  _m a reference to the Markus Configuration Object is passed
 **/
( function(_m) {

/**
 * Converts an array of objects into TSV data to be saved. Shortcut to
 * &#x60;markus.data.objArrayToTSV&#x60;
 *
 * @method markupToTSV
 * @param  {Array} dataArray the data to be converted
 * @return {String}          the string that contains the converted TSV data
 */
var markupToTSV = function(dataArray) {
    return _m.data.objArrayToTSV(dataArray);
}


/**
 * Converts an array of objects into CSV data to be saved. Shortcut to
 * &#x60;markus.data.objArrayToCSV&#x60;
 *
 * @method markupToCSV
 * @param  {Array} dataArray the data to be converted
 * @return {String}          the string that contains the converted CSV data
 */
var markupToCSV = function(dataArray) {
    return _m.data.objArrayToCSV(dataArray);
}


/**
 * Converts an array of objects into HTML data to be saved. Shortcut to
 * &#x60;markus.data.objArrayToHTML&#x60;
 *
 * @method markupToHTMl
 * @param  {Array} dataArray the data to be converted
 * @return {String}          the string that contains the converted HTML data
 */
var markupToHTML = function(dataArray) {
    return _m.data.objArrayToHTML(dataArray);
}

/**
 * This function analyses the provided markupArray. It counts every type
 * or tag and saves these statistics in the returned &#x60;summary&#x60; object. For each
 * type or tag we count the unique and total occurences.
 *
 * @method markupTypeUniqueAndQuantitySummary
 * @param  {Array} markupArray contains the markup data to be analyzed
 * @return {Object}            contains the analysis data ordered by markup type
 */
var markupTypeUniqueAndQuantitySummary = function(markupArray) {
    var summary = {};
    for (var index in markupArray) {
        var tag = markupArray[index];
        // console.log(tag.type);

        //either continue counting if it is a known type, or initialize counting
        var typeCount = summary[tag.type] || {
                unique: 0,
                count: 0
            };
        var tagCount = typeCount[tag.tag];
        if (!tagCount) {
            tagCount = {
                count: 0
            };
            typeCount.unique++;
        }
        //Increase the occurence amount
        tagCount.count++;
        typeCount.count++;
        //Save the data in the saveObject for this type
        typeCount[tag.tag] = tagCount;
        //Save that object into the result object to be returned at the end
        summary[tag.type] = typeCount;
    }
    return summary;
}

/**
 * Exports the provided &#x60;dataArray&#x60; to a file ending in the provided &#x60;fileType&#x60;
 * extension using the provided &#x60;csvFn&#x60; function to create the data.
 *
 * @method exportCSV
 * @param  {Function} csvFn    the function that will transform the data to CSV
 * @param  {Array} dataArray  the data Array to be converted
 * @param  {String} fileType  the fileType extension of the file to save
 */
var exportCSV = function(csvFn, dataArray, fileType) {
  //Request a location to save the file.
    window.webkitRequestFileSystem(window.TEMPORARY, 1024 * 1024, function(fs) {
      //Try to find the file for the file we&#x27;re working on
        fs.root.getFile($(&#x27;.doc&#x27;).attr(&#x27;filename&#x27;) + &quot;.data.&quot; + fileType, {
            create: false
        }, function(fileEntry) {
            //If it exists, remove it
            fileEntry.remove(function() {
                console.log(&#x27;File removed.&#x27;);
                //and write a new version
                saveCSV(csvFn, dataArray, fileType);
            }, function() {
              //If it can&#x27;t be removed, just write
                saveCSV(csvFn, dataArray, fileType);
            });
        }, function() {
          //If the file doesn&#x27;t exist, just write
            saveCSV(csvFn, dataArray, fileType);
        });
    }, function() {
      //If we can&#x27;t get access to the FS, just write
        saveCSV(csvFn, dataArray, fileType);
    });
}

/**
 * Writes the provided &#x60;dataArray&#x60; to a file with the &#x60;fileType&#x60; extension that
 * was provided using the &#x60;bloblFn&#x60; function to convert the &#x60;dataArray&#x60; to a
 * binary blob.
 *
 * @method save
 * @param  {Function} blobFn   the method to convert a dataArray to a Blob
 * @param  {Array} dataArray  the array containing the data
 * @param  {String} fileType  the fileType extension for the resulting saved file
 */
var save = function(blobFn, dataArray, fileType) {
  //Request acces to the fileSystem
    window.webkitRequestFileSystem(window.TEMPORARY, 1024 * 1024, function(fs) {
        console.log(&quot;exporting file&quot;);
        fs.root.getFile($(&#x27;.doc&#x27;).attr(&#x27;filename&#x27;) + &quot;.data.xlsx&quot;, {
            create: true
        }, function(fileEntry) {
            fileEntry.createWriter(function(fileWriter) {
                var blob = blobFn(dataArray);
                fileWriter.addEventListener(&quot;writeend&quot;, function() {

                    $(&#x27;#export&#x27;).attr(&quot;href&quot;, fileEntry.toURL()).attr(&quot;download&quot;, $(&#x27;.doc&#x27;).attr(&#x27;filename&#x27;) + &quot;.data.&quot; + fileType)
                    $(&#x27;#export&#x27;)[0].click();
                }, false);
                fileWriter.write(blob);

              //If we don&#x27;t get WRITE access, log the error using the default error handler
            }, _m.util.errorHandler);

            //If we don&#x27;t get access, log the error using the default error handler
        }, _m.util.errorHandler);
        //If we don&#x27;t get access, log the error using the default error handler
    }, _m.util.errorHandler);
}

/**
 * Generates Microsoft Excel data from the provided &#x60;dataArray&#x60;.
 *
 * @method genXLSX
 * @param  {Array} dataArray the array to be converted into XLSX
 * @return {Blob}           a Blob containing the XLSX data
 */
var genXLSX = function(dataArray) {
  //Temporary HTML holder where we can store the HTML data generated by the markupToHTML function
    $(&quot;body&quot;).prepend($(&quot;&lt;span id=&#x27;saving_temp&#x27; style=&#x27;display:none&#x27;&gt;&quot; + markupToHTML(dataArray) + &quot;&lt;/span&gt;&quot;));
    var theTable = document.getElementById(&quot;exportTable&quot;);
    //Object array generated from the exporttable
    var oo = generateArray(theTable);
    var ranges = oo[1];

    /* original data */
    var data = oo[0];
    var ws_name = &quot;MARKUS_EXPORT&quot;;
    // console.log(data);

    //Create a new Workbook, Excel file
    var wb = new Workbook();
    //Generate a sheet from array
    var ws = sheet_from_array_of_arrays(data);

    /* add ranges to worksheet */
    ws[&#x27;!merges&#x27;] = ranges;

    /* add worksheet to workbook */
    wb.SheetNames.push(ws_name);
    //Attach the sheet to the workbook
    wb.Sheets[ws_name] = ws;

    //Generate a about workbook
    var wbout = XLSX.write(wb, {
        bookType: &#x27;xlsx&#x27;,
        bookSST: false,
        type: &#x27;binary&#x27;
    });
    //Remove the temporary HTML holder for the data now that we&#x27;re done
    $(&quot;#saving_temp&quot;).remove();

    //Return a new blob containing the output of the XLSX write function
    return new Blob([s2ab(wbout)], {
        type: &quot;application/octet-stream&quot;
    });

}

/**
 * Saves the provided &#x60;dataArray&#x60; to a file with the &#x60;fileType&#x60; extension using
 * the &#x60;csvFn&#x60; function.
 *
 * @method saveCSV
 * @param  {Function} csvFn     the funtion to convert array to csv
 * @param  {Array} dataArray the array of data
 * @param  {String} fileType  the extension of the saveFile
 */
var saveCSV = function(csvFn, dataArray, fileType) {
  //Request access to the FS
    window.webkitRequestFileSystem(window.TEMPORARY, 1024 * 1024, function(fs) {
        console.log(&quot;exporting file&quot;);
        //Try to get reference to the file
        fs.root.getFile($(&#x27;.doc&#x27;).attr(&#x27;filename&#x27;) + &quot;.data.&quot; + fileType, {
            create: true
        }, function(fileEntry) {
          //Try to get write access to the file
            fileEntry.createWriter(function(fileWriter) {
                var blob = new Blob([csvFn(dataArray)]);
                fileWriter.addEventListener(&quot;writeend&quot;, function() {

                    $(&#x27;#export&#x27;).attr(&quot;href&quot;, fileEntry.toURL()).attr(&quot;download&quot;, $(&#x27;.doc&#x27;).attr(&#x27;filename&#x27;) + &quot;.data.&quot; + fileType)
                    $(&#x27;#export&#x27;)[0].click();
                }, false);
                //Finally write to the file
                fileWriter.write(blob);
                //If there is an error along the way, log it with the default error handler
            }, _m.util.errorHandler);
        }, _m.util.errorHandler);
    }, _m.util.errorHandler);
};

/**
 * Defines the functions and variables availabe to the code outside of this file through
 * the &#x60;markus.summary&#x60; object. Uses some functions that have been defined in the summary.js_anonymous
 * namespace.
 *
 * @class Summary
 */
_m.summary = {
    /**
     * Saves the data filtered by the provided boolean flags to a XLSX file.
     * First calls &#x60;markus.data.getMarkupsArray&#x60; with the provided parameters,
     * then calls the &#x60;save&#x60; function from the summary.js_anonymous namespace
     * using the generated dataArray
     *
     * @method outputXLSX
     * @param  {boolean} withPassage     if we want the passage that contains the markup
     * @param  {boolean} withSupportText if we want surrounding text
     * @param  {number} noOfChars       the number of chars to include
     */
    outputXLSX: function(withPassage, withSupportText, noOfChars) {
        var dataArray = _m.data.getMarkupsArray(withPassage, withSupportText, noOfChars);
        save(genXLSX, dataArray, &quot;xlsx&quot;);
    },
    /**
     * Array that holds data that can be saved. Empty by default.
     *
     * @type {Array}
     */
    dataArray: [],

    /**
     * Array that holds a summary of all the tag types. Empty by default
     *
     * @type {Array}
     */
    summaryArray: [],

    /**
     * Creates a summary of the document tags in a HTML table. Returns the generated HTML
     * upon completion.
     *
     * @return {String} the generated HTML table containing the document tag summary.
     */
    docTagSummary: function() {
        var dataArray = this.dataArray = _m.data.getMarkupsArray(true, false);
        var content = &quot;&quot;;
        //Generate the summary using the markupTypeUniqueAndQuantitySummary function
        var summary = this.summaryArray = markupTypeUniqueAndQuantitySummary(dataArray);
        content = &quot;&lt;table class=&#x27;table table-bordered table-condensed&#x27;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td&gt;Type&lt;/td&gt;&lt;td&gt;Unique&lt;/td&gt;&lt;td&gt;Total&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;

        //For each type we add a new row in the table
        for (var type in summary) {
            content += &quot;&lt;tr&gt;&lt;td class=&#x27;&quot; + type + &quot;&#x27;&gt;&quot; + type + &quot;&lt;/td&gt;&lt;td&gt;&quot; + summary[type].unique + &quot;&lt;/td&gt;&lt;td&gt;&quot; + summary[type].count + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;;
        }
        //Finish of the table
        content += &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;

        //Return the generated data
        return content;
    },

    /**
     * Exports the markupsArray that is generated according to the provided parameters
     * (i.e. the two boolean flags and the number of characters requirement). Internally
     * uses the &#x60;markus.data.getMarkupsArray&#x60; function and the &#x60;exportCSV&#x60; function defined
     * in the summary.js_anonymous namespace.
     *
     * @method outputCSV
     * @param  {boolean} withPassage    Should we include the passage
     * @param  {boolean} withSupportText Should we include the supporting text
     * @param  {Integer} noOfChars       How many characters should we include
     */
    outputCSV: function(withPassage, withSupportText, noOfChars) {
        var dataArray = _m.data.getMarkupsArray(withPassage, withSupportText, noOfChars);
        exportCSV(markupToCSV, dataArray, &quot;csv&quot;);
    },
    /**
     * Exports the markupsArray that is generated according to the provided parameters
     * (i.e. the two boolean flags and the number of characters requirement). Internally
     * uses the &#x60;markus.data.getMarkupsArray&#x60; function and the &#x60;exportCSV&#x60; function defined
     * in the summary.js_anonymous namespace.
     *
     * @method outputTSV
     * @param  {boolean} withPassage    Should we include the passage
     * @param  {boolean} withSupportText Should we include the supporting text
     * @param  {Integer} noOfChars       How many characters should we include
     */
    outputTSV: function(withPassage, withSupportText, noOfChars) {
        var dataArray = _m.data.getMarkupsArray(withPassage, withSupportText, noOfChars);
        exportCSV(markupToTSV, dataArray, &quot;txt&quot;);
    },
    /**
     * Exports the markupsArray that is generated according to the provided parameters
     * (i.e. the two boolean flags and the number of characters requirement). Internally
     * uses the &#x60;markus.data.getMarkupsArray&#x60; function and the &#x60;exportCSV&#x60; function defined
     * in the summary.js_anonymous namespace.
     *
     * @method outputHTML
     * @param  {boolean} withPassage    Should we include the passage
     * @param  {boolean} withSupportText Should we include the supporting text
     * @param  {Integer} noOfChars       How many characters should we include
     */
    outputHTML: function(withPassage, withSupportText, noOfChars) {
        var dataArray = _m.data.getMarkupsArray(withPassage, withSupportText, noOfChars);
        exportCSV(markupToHTML, dataArray, &quot;html&quot;);
    }

};

} )(markus);

/**
 * Registers the click handlers for the following buttons:
 * &#x60;#exportDataToCSV&#x60;, &#x60;#exportDataToTSV&#x60;, &#x60;#exportDataToHTML&#x60; and
 * &#x60;exportDataToXLSX&#x60;.
 *
 * Also defines the click behaviour of the show summary button that
 * shows a summary of the tag-usage of the document in a modal window.
 *
 * @for Global
 * @method registMarkupSummary
 */
var registMarkupSummary = function() {
    $(&quot;#exportDataToCSV&quot;).on(&quot;click&quot;, function() {
        var withPassage = $(&quot;.doc .passage&quot;).length &gt; 0;
        var withSupportText = $(&quot;#withSupportText&quot;).prop(&quot;checked&quot;);
        var noOfChars = $(&quot;#noOfCharacter&quot;).val();
        markus.summary.outputCSV(withPassage, withSupportText, noOfChars);
    // $.exportCSV(tagToCSV,&quot;csv&quot;);
    });
    $(&quot;#exportDataToTSV&quot;).on(&quot;click&quot;, function() {
        var withPassage = $(&quot;.doc .passage&quot;).length &gt; 0;
        var withSupportText = $(&quot;#withSupportText&quot;).prop(&quot;checked&quot;);
        var noOfChars = $(&quot;#noOfCharacter&quot;).val();
        markus.summary.outputTSV(withPassage, withSupportText, noOfChars);
    // $.exportCSV(tagToTSV,&quot;txt&quot;);
    });
    $(&quot;#exportDataToHTML&quot;).on(&quot;click&quot;, function() {
        var withPassage = $(&quot;.doc .passage&quot;).length &gt; 0;
        var withSupportText = $(&quot;#withSupportText&quot;).prop(&quot;checked&quot;);
        var noOfChars = $(&quot;#noOfCharacter&quot;).val();
        markus.summary.outputHTML(withPassage, withSupportText, noOfChars);
    // $.exportCSV(tagToHTML,&quot;html&quot;);
    });
    $(&quot;#exportDataToXLSX&quot;).on(&quot;click&quot;, function() {
        var withPassage = $(&quot;.doc .passage&quot;).length &gt; 0;
        var withSupportText = $(&quot;#withSupportText&quot;).prop(&quot;checked&quot;);
        var noOfChars = $(&quot;#noOfCharacter&quot;).val();
        markus.summary.outputXLSX(withPassage, withSupportText, noOfChars);
    // $.exportCSV(tagToHTML,&quot;html&quot;);
    });
    $(&quot;#showSummaryModalBtn&quot;).on(&quot;click&quot;, function() {
        $(&#x27;#summaryModal a[href=&quot;#summary&quot;]&#x27;).tab(&#x27;show&#x27;);
        $(&quot;#summaryModal .tagSummary&quot;).html(markus.summary.docTagSummary());
        $(&quot;#summaryModal&quot;).modal(&quot;show&quot;);
    });
}

/**
 * Returns the egdes of the tags in an array.
 *
 * @method tagToEdges
 * @return {Array} array that holds the edges
 */
var tagToEdges = function() {
    var edges = [];
    var objArray = tagToJSON();
    var uniqueObjArray = [];
    //Generate an array of only the unique elements in the objArray variable
        var obj = objArray[index];
        for (var index in objArray) {
        var found = false;
        for (var _index in uniqueObjArray) {
            if (uniqueObjArray[_index].passageId == obj.passageId &amp;&amp;
                    uniqueObjArray[_index].type == obj.type &amp;&amp;
                    uniqueObjArray[_index].tag == obj.tag &amp;&amp;
                    uniqueObjArray[_index].id == obj.id || uniqueObjArray[_index].id == obj.id) {
                // console.log(uniqueObjArray[_index]);
                // console.log(obj);
                found = true;
                break;
            }
        }
        if (!found) {
            uniqueObjArray.push(obj);
        }
    }
    //Log both the lenghts
    console.log(objArray.length);
    console.log(uniqueObjArray.length);

    //If there are items in the uniqueObjArray
    if (uniqueObjArray.length &gt; 0) {
        var perviousPassageId = null;
        var processedObjects = [];
        //For each of the items in the array
        for (var index in uniqueObjArray) {
            var obj = uniqueObjArray[index];

            //We get its passageId. If the previous passage is null or the passageID is not identical
            //to the previousPassageId, we reset it (i.e. we switch passage).
            var passageId = obj.passageId || &quot;&quot;;
            if (perviousPassageId == null || passageId != perviousPassageId) {
                processedObjects = [];
                perviousPassageId = passageId;
            }
            ///For each of the entries in processedObjects
            for (var _index in processedObjects) {
                var sourceObj = processedObjects[_index];
                edges.push({
                    sourceType: sourceObj.type,
                    sourceTag: sourceObj.tag,
                    sourceId: sourceObj.id,
                    targetType: obj.type,
                    targetTag: obj.tag,
                    targetId: obj.id,
                    passageId: passageId
                });
            }
            processedObjects.push(obj);
        }
    }
    //The edge cases .
    return edges;
}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
