<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\js\manualMarkup.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ColorSwitcher.html">ColorSwitcher</a></li>
                                <li><a href="../classes/Comment.html">Comment</a></li>
                                <li><a href="../classes/comment.js_anonymous.html">comment.js_anonymous</a></li>
                                <li><a href="../classes/Data.html">Data</a></li>
                                <li><a href="../classes/Global.html">Global</a></li>
                                <li><a href="../classes/helpInfo.js_anonymous.html">helpInfo.js_anonymous</a></li>
                                <li><a href="../classes/IO.html">IO</a></li>
                                <li><a href="../classes/io.js_anonymous.html">io.js_anonymous</a></li>
                                <li><a href="../classes/JQuery.html">JQuery</a></li>
                                <li><a href="../classes/ManualMarkup.html">ManualMarkup</a></li>
                                <li><a href="../classes/manualMarkup.js_anonymous.html">manualMarkup.js_anonymous</a></li>
                                <li><a href="../classes/markupPopup.js_anonymous.html">markupPopup.js_anonymous</a></li>
                                <li><a href="../classes/navbar.js_anonymous.html">navbar.js_anonymous</a></li>
                                <li><a href="../classes/Popup.html">Popup</a></li>
                                <li><a href="../classes/Regex.html">Regex</a></li>
                                <li><a href="../classes/Summary.html">Summary</a></li>
                                <li><a href="../classes/summary.js_anonymous.html">summary.js_anonymous</a></li>
                                <li><a href="../classes/switcher.js_anonymous.html">switcher.js_anonymous</a></li>
                                <li><a href="../classes/tagRegex.js_anonymous.html">tagRegex.js_anonymous</a></li>
                                <li><a href="../classes/UI.html">UI</a></li>
                                <li><a href="../classes/ui.js_anonymous.html">ui.js_anonymous</a></li>
                                <li><a href="../classes/Util.html">Util</a></li>
                                <li><a href="../classes/utilities.js_anonymous.html">utilities.js_anonymous</a></li>
                                <li><a href="../classes/WebDictionary.html">WebDictionary</a></li>
                                <li><a href="../classes/webDictionary.js_anonymous.html">webDictionary.js_anonymous</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/comment.js.html">comment.js</a></li>
                                <li><a href="../modules/data.js.html">data.js</a></li>
                                <li><a href="../modules/helpInfo.js.html">helpInfo.js</a></li>
                                <li><a href="../modules/io.js.html">io.js</a></li>
                                <li><a href="../modules/markupPopup.js.html">markupPopup.js</a></li>
                                <li><a href="../modules/markus.js.html">markus.js</a></li>
                                <li><a href="../modules/navbar.js.html">navbar.js</a></li>
                                <li><a href="../modules/reference.js.html">reference.js</a></li>
                                <li><a href="../modules/summary.js.html">summary.js</a></li>
                                <li><a href="../modules/switcher.js.html">switcher.js</a></li>
                                <li><a href="../modules/tagRegex.js.html">tagRegex.js</a></li>
                                <li><a href="../modules/TestModule.html">TestModule</a></li>
                                <li><a href="../modules/ui.js.html">ui.js</a></li>
                                <li><a href="../modules/utilities.js.html">utilities.js</a></li>
                                <li><a href="../modules/webDictionary.js.html">webDictionary.js</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\js\manualMarkup.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * manualMarkup.js base file.
 * @module io.js
 */

 /**
 The class that holds the variables and functions created in the namespace of this file.
 The constrcutor of this object is only called once, because it is an anonymous function.

 @class manualMarkup.js_anonymous
 @constructor
 @param {Object}  _m a reference to the Markus Configuration Object is passed
 **/
( function(_m) {

    /**Holds the tag toggle*/
    var tagToggle = null;

    /**
     * This function cleans the class attribute of the element this is called on.
     *
     * @method registMakupAction
     * @param {Span} justAdd  one of the spans that still has the justAdd class
     */
    var registMakupAction = function() {
        var _class = $(this).attr(&quot;class&quot;);
        $(this).attr(&quot;class&quot;, _class.trim());
    }

    /**
     * Called when we have a new type of markup to save. We set the classes on
     * the corresponding element, and fadeout the &#x60;singleTagContent&#x60; css class
     * elements. Also shows the &#x60;.search&#x60; element at the end of the function.
     *
     * @method newtypeSave
     */
    var newtypeSave = function() {
        //get a reference to the just clicked markup instance
        var clickedMarkup = _m.popup.clickedMarkup;
        //remove the &#x60;&#x60;.justAdd&#x60; class if it already was added. From all the elements
        //that have it right now, including just clicked markup
        $(&quot;.justAdd&quot;).removeClass(&quot;justAdd&quot;);

        //If there is an element within #manualPopover that has the switch element
        //with a defined color
        if ($(&quot;#manualPopover&quot;).find(&quot;.switch:not(.noColor)&quot;).length &gt; 0) {
            //remove class: &#x60;justselected&#x60;,
            //add class: &#x60;justAdd&#x60;, &#x60;markup&#x60;, &#x60;manual&#x60;, &#x60;unsolved&#x60;
            //From the clicked markup we get in the beginning of the function
            $(clickedMarkup).removeClass(&quot;justSelected&quot;).addClass(&quot;justAdd&quot;).addClass(&quot;markup&quot;).addClass(&quot;manual&quot;).addClass(&quot;unsolved&quot;);

            //Get the type of the manualPopover switch.
            var type = $(&quot;#manualPopover&quot;).find(&quot;.switch:not(.noColor)&quot;).attr(&quot;_type&quot;);

            //Do based on type
            switch (type) {
                case &quot;fullName&quot;:
                case &quot;partialName&quot;:
                    //In case it&#x27;s a name, we add that is has no CBDBID.
                    $(clickedMarkup).addClass(type).addClass(&quot;noCBDBID&quot;).attr(&quot;type&quot;, type).attr(&quot;cbdbid&quot;, &quot;&quot;);
                    break;
                default:
                    //Else we just add the type attribute as the type.
                    $(clickedMarkup).addClass(type).attr(&quot;type&quot;, type);
            }
        }

        //We fadeout the singleTagContent element
        $(&quot;#manualPopover&quot;).find(&quot;.singleTagContent&quot;).fadeOut();
        //For each of the just added elements we call the &#x60;registMakupAction&#x60;,
        //This function just cleans the class assignement.
        $(&quot;.doc&quot;).find(&quot;span.justAdd&quot;).each(registMakupAction);
        //We find the search element and show it
        $(&quot;#manualPopover&quot;).find(&quot;.search&quot;).show();

        // $(&quot;#manualPopover&quot;).find(&quot;.glyphicon-search&quot;).click();
    }

    /**
     * Function called when either &#x60;applyAllBtn&#x60; or &#x60;removeAllBtn&#x60; has fired
     * and event and we want to process it. This just removes the &#x60;fired&#x60; class
     * from both of those buttons if present.
     *
     * @method initialRemoveModal
     */
    var initialRemoveModal = function() {
        $(&quot;#applyAllBtn&quot;).removeClass(&quot;fired&quot;);
        $(&quot;#removeAllBtn&quot;).removeClass(&quot;fired&quot;);
    }

    /**
     * Shows and or hides the &#x60;#removeModal&#x60; and the &#x60;#removeAll&#x60; and &#x60;#applyAll&#x60; buttons
     *
     * @method updateRemoveModal
     */
    var updateRemoveModal = function() {
        // console.log($(&quot;#removeModal&quot;).find(&quot;.well&quot;).length);

        //Swtich based on the amount of wells found within the #removeModal element
        switch ($(&quot;#removeModal&quot;).find(&quot;.well&quot;).length) {
            case 0:
                //If none were found, hide the modal
                $(&quot;#removeModal&quot;).modal(&quot;hide&quot;);
                break;
            case 1:
                //If there was one, hide both the removeAll and applyAll button.
                $(&quot;#removeAllBtn&quot;).hide();
                $(&quot;#applyAllBtn&quot;).hide();
                break;
            default:
                //If there are a different amount of wells

                //Set the styling of the first well with the sameTags class
                $(&quot;#removeModal&quot;).find(&quot;.sameTags .well:first&quot;).css({
                    &quot;border-width&quot;: &quot;2px&quot;,
                    &quot;border-color&quot;: &quot;#8D8C8C&quot;,
                    &quot;background-color&quot;: &quot;#D8D5D5&quot;
                });

                //If the removeAllBtn has the fired class, show it, else fadeOut
                if (!$(&quot;#removeAllBtn&quot;).hasClass(&quot;fired&quot;)) {
                    $(&quot;#removeAllBtn&quot;).show();
                } else {
                    $(&quot;#removeAllBtn&quot;).fadeOut();
                }


                //If the applyAllBtn has the fired class, show it, else fadeOut
                if (!$(&quot;#applyAllBtn&quot;).hasClass(&quot;fired&quot;)) {
                    $(&quot;#applyAllBtn&quot;).show();
                } else {
                    $(&quot;#applyAllBtn&quot;).fadeOut();
                }

        }

    }

    /**
     * Shows the just created markup instance. Sets the classes of the markup element.
     *
     * @method showManualMarkup
     */
    var showManualMarkup = function() {
        //Get a reference to the clicked Markup
        var clickedMarkup = _m.popup.clickedMarkup;

        //Hide the popOver class objects
        $(&quot;.popover&quot;).hide();

        //Get the text of the clickedMarkup.
        var text = $(clickedMarkup).text();

        //If there is no text in the clickedMarkup this is not a valid state,
        //return without doing anything.
        if (text.trim().length == 0) {
            return;
        }

        //get the html from the document and then set it back to the html
        //that we jus retrieved. Unsure what this does.
        var html = $(&quot;.doc&quot;).html();
        $(&quot;.doc&quot;).html(html);


        //Wrap all of the elements in the document that have a nodeType of 3
        //and a nodevalue that matches the clickedMarkups textValue in a
        //&#x60;&lt;wrap&gt;&#x60; element.
        $(&quot;.doc&quot;).find(&quot;*&quot;).contents().filter(function() {
            return this.nodeType === 3 &amp;&amp; this.nodeValue.indexOf(text) &gt; -1;
        }).wrap(&quot;&lt;wrap&gt;&quot;);
        // console.log(items);

        //Replace all wrap elements in this function
        $(&quot;wrap&quot;).replaceWith(function() {
            //Replaces all instances with an &#x60;span&#x60; element with the &#x60;justExtended&#x60;, &#x60;unsolved&#x60; and &#x60;markup&#x60; classes.
            return $(&quot;&lt;wrap&gt;&quot; + $(this).text().replace(new RegExp(text, &#x27;g&#x27;), &quot;&lt;span class=&#x27;justExtended unsolved markup&#x27;&gt;&quot; + text + &quot;&lt;/span&gt;&quot;) + &quot;&lt;/wrap&gt;&quot;);
        });
        //Unwraps the contents, removes the wrapping elements now that the changes have been made.
        $(&quot;wrap&quot;).contents().unwrap();

        //If there are elements with the &#x60;justAdd&#x60; class
        if ($(&quot;.doc&quot;).find(&quot;.justAdd&quot;).length &gt; 0) {
            $(&quot;.doc&quot;).find(&quot;.justAdd .justExtended&quot;).contents().unwrap();
            clickedMarkup = $(&quot;.doc&quot;).find(&quot;.justAdd&quot;);
        } else if ($(&quot;.doc&quot;).find(&quot;.justSelected .justExtended&quot;).length &gt; 0) {
            //Else we unwrap the &#x60;.justSelected&#x60; contents
            clickedMarkup = $(&quot;.doc&quot;).find(&quot;.justSelected .justExtended&quot;);
            $(&quot;.doc&quot;).find(&quot;.justSelected&quot;).contents().unwrap();
        }

        //Get the extended spans with parents that have the same text as the child element
        var extended = $(&quot;span.justExtended&quot;).filter(function() {
            var parent = $(this).parent();
            if (parent.hasClass(&quot;markup&quot;)) {
                return $(parent).text() == $(this).text();
            }
            return false;

        });

        //Unwrap all those identical elements
        extended.contents().unwrap();

        //Then we show all the same markups
        _m.popup.showSameMarkup();
    }


    /**
     * Defines the &#x60;markus.manualMarkup&#x60; object that can be accessed globally. Uses some functions that have
     * been defined in the manualMarkup.js anonymous namespace, but also defines some functions in the object
     * creation itself.
     *
     * @class ManualMarkup
     * @constructor
     */
    _m.manualMarkup = {
        /**
         * Handles the registering of manual markup. Handles the necessary registering
         * of event handlers and takes care of the selection from the document.
         *
         * @method registManualMarkup
         * @param  {Object} editable An editable object
         */
        registManualMarkup: function(editable) {
            var editable = editable || false;
            rangy.init();


            if (rangy.supported &amp;&amp; rangy.modules.CssClassApplier &amp;&amp; rangy.modules.CssClassApplier.supported) {
                tagToggle = rangy.createCssClassApplier(&quot;justSelected&quot;, {
                    tagNames: [&quot;markup&quot;]
                });
            } else {
                alert(&quot;error&quot;);
            }

            //Click handler for the document
            $(document).on(&quot;click&quot;, &quot;.doc&quot;, function() {
                //We get a selection from the rangy plugin
                var sel = rangy.getSelection();

                // var selContainerNode = null;
                // If there is even a selection
                if (sel.rangeCount &gt; 0) {
                    // console.log(sel);
                    tagToggle.applyToSelection();
                    // console.log($(&quot;.justSelected&quot;));
                    // We set all the initial stats of the &#x60;#manualPopover&#x60; element
                    var popover = $(&quot;#manualPopover&quot;);
                    popover.find(&quot;.tagText&quot;).hide();
                    popover.find(&quot;.typePopoverContent&quot;).hide();
                    popover.find(&quot;.singleTagContent&quot;).show();

                    popover.find(&quot;.glyphicon-collapse-down&quot;).show();
                    popover.find(&quot;.expand&quot;).show();
                    popover.find(&quot;.typePopoverContent .btn.switch&quot;).addClass(&quot;noColor&quot;);
                    popover.find(&quot;.typePopoverContent .glyphicon-floppy-disk&quot;).addClass(&quot;disabled&quot;);

                    //If a valid editable was passed we show the &#x60;typePopoverContent&#x60;
                    if (editable) {
                        popover.find(&quot;.typePopoverContent&quot;).show();
                    }

                    //If there are &#x60;.justSelected&#x60; spans
                    var term = $(&quot;.justSelected&quot;);
                    if (term.length &gt; 0) {
                        term = $(&quot;.justSelected&quot;)[0];
                        var offset = $(term).offset();
                        //we set a ref to the just clicked term
                        _m.popup.clickedMarkup = $(term);

                        //We show the popover next to the just clicked term
                        $(popover).show().offset({
                            top: $(term).offset().top + $(term).height() / 2 - $(popover).outerHeight() / 2,
                            left: $(term).offset().left + $(term).outerWidth() + 11
                        });
                    }

                }
            });

            //Registers some clickhandlers, some of which call back to the anonymous namespace used above
            $(&quot;#manualPopover .glyphicon-book&quot;).on(&quot;click&quot;, _m.popup.searchMarkup);
            $(&quot;#manualPopover .glyphicon-floppy-disk&quot;).on(&quot;click&quot;, newtypeSave);
            $(&quot;#manualPopover .glyphicon-search&quot;).on(&quot;click&quot;, showManualMarkup);
            // $(&quot;#manualPopover .glyphicon-trash&quot;).on(&quot;click&quot;, function() {
            //     alert(&quot;trash&quot;);

            // });

            //When we cloick on the &#x60;.typePopoverContent&#x60;
            $(&quot;#manualPopover .typePopoverContent&quot;).on(&quot;click&quot;, &quot;button.switch&quot;, function() {
                // if($(this).attr(&quot;markupType&quot;)){
                $(&quot;#manualPopover .glyphicon-floppy-disk&quot;).removeClass(&quot;disabled&quot;);
                $(&quot;#manualPopover .typePopoverContent button.switch&quot;).addClass(&quot;noColor&quot;);
                $(this).removeClass(&quot;noColor&quot;);
                // $(&quot;.doc&quot;).find(&quot;.&quot;+$(this).attr(&quot;markupType&quot;)).toggleClass(&quot;noColor&quot;);
                // }
            });

            //If we click on the &#x60;glyphicon-collapse-down&#x60;
            $(&quot;#manualPopover&quot;).find(&quot;.glyphicon-collapse-down&quot;).on(&quot;click&quot;, function() {
                var expand = $(this).parent();
                expand.hide();
                $(expand).parent().find(&quot;.search&quot;).hide();
                $(expand).parent().find(&quot;.typePopoverContent&quot;).fadeIn();
            });

            //When the &#x60;initial&#x60; or &#x60;update&#x60; event are passed
            $(&quot;#removeModal&quot;).on(&quot;update&quot;, updateRemoveModal);
            $(&quot;#removeModal&quot;).on(&quot;initial&quot;, initialRemoveModal);

            //When the removeModal hides
            $(&quot;#removeModal&quot;).on(&quot;hide.bs.modal&quot;, function() {
                // var parent = $(&quot;.justSelected,.justExtended&quot;).parent();
                $(&quot;.justSelected,.justExtended&quot;).contents().unwrap();

            });
        }

    };


} )(markus);

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
