<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\js\utilities.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ColorSwitcher.html">ColorSwitcher</a></li>
                                <li><a href="../classes/Comment.html">Comment</a></li>
                                <li><a href="../classes/comment.js_anonymous.html">comment.js_anonymous</a></li>
                                <li><a href="../classes/Data.html">Data</a></li>
                                <li><a href="../classes/Global.html">Global</a></li>
                                <li><a href="../classes/helpInfo.js_anonymous.html">helpInfo.js_anonymous</a></li>
                                <li><a href="../classes/IO.html">IO</a></li>
                                <li><a href="../classes/io.js_anonymous.html">io.js_anonymous</a></li>
                                <li><a href="../classes/JQuery.html">JQuery</a></li>
                                <li><a href="../classes/ManualMarkup.html">ManualMarkup</a></li>
                                <li><a href="../classes/manualMarkup.js_anonymous.html">manualMarkup.js_anonymous</a></li>
                                <li><a href="../classes/navbar.js_anonymous.html">navbar.js_anonymous</a></li>
                                <li><a href="../classes/Regex.html">Regex</a></li>
                                <li><a href="../classes/switcher.js_anonymous.html">switcher.js_anonymous</a></li>
                                <li><a href="../classes/tagRegex.js_anonymous.html">tagRegex.js_anonymous</a></li>
                                <li><a href="../classes/UI.html">UI</a></li>
                                <li><a href="../classes/ui.js_anonymous.html">ui.js_anonymous</a></li>
                                <li><a href="../classes/Util.html">Util</a></li>
                                <li><a href="../classes/utilities.js_anonymous.html">utilities.js_anonymous</a></li>
                                <li><a href="../classes/WebDictionary.html">WebDictionary</a></li>
                                <li><a href="../classes/webDictionary.js_anonymous.html">webDictionary.js_anonymous</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/comment.js.html">comment.js</a></li>
                                <li><a href="../modules/data.js.html">data.js</a></li>
                                <li><a href="../modules/helpInfo.js.html">helpInfo.js</a></li>
                                <li><a href="../modules/io.js.html">io.js</a></li>
                                <li><a href="../modules/markus.js.html">markus.js</a></li>
                                <li><a href="../modules/navbar.js.html">navbar.js</a></li>
                                <li><a href="../modules/reference.js.html">reference.js</a></li>
                                <li><a href="../modules/switcher.js.html">switcher.js</a></li>
                                <li><a href="../modules/tagRegex.js.html">tagRegex.js</a></li>
                                <li><a href="../modules/ui.js.html">ui.js</a></li>
                                <li><a href="../modules/utilities.js.html">utilities.js</a></li>
                                <li><a href="../modules/webDictionary.js.html">webDictionary.js</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\js\utilities.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * utilities.js base file.
 * @module utilities.js
 */

/**
The class that holds the variables and functions created in the namespace of this file.
The constrcutor of this object is only called once, because it is an anonymous function.

@class utilities.js_anonymous
@constructor
@param {Object}  _m a reference to the Markus Configuration Object is passed
**/
( function(_m) {
//Regular expressions used to find tags
var REMOVE_ALL_EXIST_TAG_REGEX = new RegExp(&quot;([^\\x00-\\xFF]*)&quot;, &quot;gm&quot;);
var RECOVER_ALL_EXIST_TAG_REGEX = new RegExp(&quot;&amp;amp;#\\([^\\)]{1,}\\);&quot;, &quot;gm&quot;);

//defines the tagCSS and tag objects.
_m.tagCSS = {};
_m.tag = {};

/**
 * Escapes all unicode characters in the source that is passed as parameter and
 * returns the modified string.
 *
 * @for Util
 * @method convertToEscapeUnicode
 * @param  {String} source source
 * @return {String}        the unicode escaped string
 */
var convertToEscapeUnicode = function(source) {
    var result = [];
    for (var i = 0, j = source.length; i &lt; j; i++) {
        if (source[i].match(/^[\x00-\xFF]*$/)) {
            result.push(source[i]);
        } else {
            result.push(&#x27;&amp;#(&#x27; + source.charCodeAt(i) + &#x27;);&#x27;);
        }

    }
    return result.join(&quot;&quot;);
};

/**
 * Converts a unicode-escaped string generated using the &#x60;convertToEscapeUnicode&#x60; function back
 * to its unicode original. Pass a unicode-escaped string and get the unicode encoded string back.
 *
 * @for Util
 * @method converBackToUnicode
 * @param  {String} text the unicode-escaped string
 * @return {String}   the string containing unicode characters once again
 */
var converBackToUnicode = function(text) {
    var newValue = &quot;&quot;;
    if (text.match(new RegExp(&quot;&amp;(?:amp;){0,1}#\\(([^\\)]{1,})\\);&quot;, &quot;gm&quot;))) {

        newValue = text.replace(new RegExp(&quot;&amp;(?:amp;){0,1}#\\(([^\\)]{1,})\\);&quot;, &quot;gm&quot;), function($0, $1, $2) {
            return String.fromCharCode($1);
        });
    } else {
        newValue = text;
    }
    return newValue;
};

/**
 * This is the default error handler. According to previous code documentation this function should be
 * moved to the &#x60;IO&#x60; package. This function does nothing but print &#x27;Error: &#x27; in front of the logging message
 * in the console.
 *
 * @method ERROR_HANDLER
 * @param  {Error} e the error that is encountered.
 */
var ERROR_HANDLER = function(e) {
    console.log(&#x27;Error: &#x27; + e.message);
};

//Find a String inside a tag
var REX_STRING_INSIDE_TAG = new RegExp(&quot;(&lt;[^&gt;]*&gt;)&quot;, &quot;gm&quot;);
//Working with PingYin.
var PINGYIN_CACHE = pinyinEngine.cache();

/**
The class that holds all the utility functions. This class is only declared once (technically a singleton).

@class Util
**/
_m.util = {
    /*
      Todo: need to decide either return null or return empty string if there is no param appeared

    */

   //defined above
    convertToEscapeUnicode: convertToEscapeUnicode,
  //defined above
    converBackToUnicode: converBackToUnicode,
    /**
     * This method will convert a Chinese character string to Ping Yin.
     *
     * @method chineseToPingYin
     * @param  {String} chineseString A string of Chinese Characters
     * @return {String} A string of Chinese annotated in Ping Yin
     */
    chineseToPingYin: function(chineseString) {
        var pingYin = [];
        for (var i = 0, j = chineseString.length; i &lt; j; i++) {
            var pingYinChar;
            console.log(PINGYIN_CACHE[chineseString[i]]);
            if (!PINGYIN_CACHE[chineseString[i]]) {
                pingYinChar = chineseString[i];
            } else {
                var _temp = PINGYIN_CACHE[chineseString[i]][0];
                pingYinChar = _temp.charAt(0).toUpperCase() + _temp.slice(1);
            }
            pingYin.push(pingYinChar);
        }

        return pingYin.join(&quot;&quot;).split(&#x27; &#x27;).join(&#x27;_&#x27;);
    },

    /**
     * Reads the URL parameters that are included in the location (A.K.A the URL request bar
     * in the top of your browser. The address bar). Using this function you can request &#x60;GET&#x60; variables
     *
     * @method urlParam
     * @param  {String} param the name of the parameter we want to extract from the GET variables
     * @return {String}       the value of the parameter (probably URL encoded) as a String.
     */
    urlParam: function(param) {
        var results = new RegExp(&#x27;[\\?&amp;]&#x27; + param + &#x27;=([^&amp;#]*)&#x27;).exec(window.location.href);
        if (results === null) {
            return null;
        } else {
            return results[1] || 0;
        }
    },

    /**
     * Used to sort two comparable regex strings. This function is called  by
     * &#x60;array.sort&#x60;
     *
     * @method sortMergerdRegex
     * @param  {String} a Compare part A
     * @param  {String} b Compare part B
     * @return {Integer}   a number signifying if a should be before or after b
     */
    sortMergerdRegex: function(a, b) {
        var alength = a.indexOf(&quot;|&quot;);
        var blength = b.indexOf(&quot;|&quot;);
        if (alength &lt; 0) {
            alength = a.length;
        }
        if (blength &lt; 0) {
            blength = b.length;
        }
        return blength - alength;
    },

    /**
     * Removes duplicates from the passed array and returns only the unique
     * values found in that array.
     *
     * @method unique
     * @param  {Array} array the array to check for doubles
     * @return {Array}        the array that only contains the unique values from the input array
     */
    unique: function(array) {

        var temp = [];
        var result = [];
        for (var i = 0, j = array.length; i &lt; j; i++) {
            temp[array[i]] = &quot;&quot;;
        }
        for (var key in temp) {
            result.push(key);
        }
        return result;
    },

    /**
     * Makes sure that no embedded markup and tags can be created. Unwraps them using
     * JQuery.
     *
     * @method removeDuplicatedTags
     * @param  {Element} container The container to check for embedded markup
     */
    removeDuplicatedTags: function(container) {
        //finds instances of double markup embedding
        $(container).find(&quot;.markup &gt; .markup&quot;).filter(function() {
            var parent = $(this).parent();
            return ($(this).text() === parent.text() &amp;&amp; $(this).attr(&quot;type&quot;) === parent.attr(&quot;type&quot;));
        }).contents().unwrap();
    },

    /**
     * Removes all remnants of tags using some more Regex magic
     *
     * @method removeAllExistTag
     * @param  {String} txt the text to remove the tags from
     * @return {String}     the cleaned string
     */
    removeAllExistTag: function(txt) {
        var newValue = txt.replace(
            REX_STRING_INSIDE_TAG, function($0, $1, $2) {
                if ($1.match(/^[\x00-\xFF]*$/)) {
                    return $1;
                } else {
                    return $1.replace(REMOVE_ALL_EXIST_TAG_REGEX, function($0, $1, $2) {
                        return convertToEscapeUnicode($1);
                    });
                }

            }
        );

        return newValue;
    },

    /**
     * Recovers all the existing tags using some Regex magic.
     *
     * @method recoverAllExistTag
     * @param  {String} txt the string we want to recover tags from
     * @return {String}     returns the newValue string in which the existing tags have been replaced
     */
    recoverAllExistTag: function(txt) {
        //Caching in a new object is not needed. Probably best to just
        //return the result of &#x60;txt.replace&#x60;
        var newValue = txt.replace(
            REX_STRING_INSIDE_TAG, function($0, $1, $2) {
                if ($1.match(RECOVER_ALL_EXIST_TAG_REGEX)) {

                    return $1.replace(new RegExp(&quot;&amp;#\\(([^\\)]{1,})\\);&quot;, &quot;gm&quot;), function($0, $1, $2) {
                        return String.fromCharCode($1);
                    });
                } else {
                    return $1;
                }

            }
        );

        return newValue;
    },

    /**
     * Short hand for &#x60;markus.io.readFile&#x60;. Deprecated.
     *
     * @deprecated Use &#x60;markus.io.readFile&#x60;
     * @method setup_reader
     */
    setup_reader: markus.io.readFile,

    /**
     * Saves the current document and moves it to a new location. Another Shorthand
     * form, also deprecated?
     *
     * @method saveAndMove
     * @param  {String} page the url of the page you want to move to
     */
    saveAndMove: function(page) {
        var fileName = $(&quot;.doc&quot;).attr(&quot;fileName&quot;);
        markus.io.removeFile(fileName + &quot;.html&quot;, function() {
            markus.io.save(fileName, function() {
                window.location = page + &quot;.html?file=&quot; + $(&quot;.doc&quot;).attr(&quot;fileName&quot;);
            });

        });
    },

    /**
     * Searches through all functions and tries to return it using the provided
     * pnamed parameter. It passes the function in its context. I.e:
     * You pass the string &#x60;&quot;markus.io.readFile&quot;&#x60; and as a return you get
     * the function &#x60;readFile&#x60; as a member of the &#x60;markus.io&#x60; object.
     *
     * @method searchFunctionByName
     * @param  {String} functionName Name of the function, preferred including the namespace.
     * @param  {Object} context     The object we&#x27;re looking in.
     * @return {Function}           Returns the string you queried by name as a member of its context.
     */
    searchFunctionByName: function(functionName, context) {
        var namespaces = functionName.split(&quot;.&quot;);
        var func = namespaces.pop();
        for (var i = 0, j = namespaces.length; i &lt; j; i++) {
            context = context[namespaces[i]];
        }
        return context[func];
    }

};

} )(markus);

/**
 * A reference to the last clicked markup. Should this be in the Global namespace?
 * @for Global
 * @type {Object}
 * @property clickedMarkup
 */
var clickedMarkup = null;

/**
 * A click handler for the &#x60;.doc&#x60; class from the document scope. It
 * removes any &#x60;.selected&#x60; class and hides the &#x60;popover&#x60;.
 */
$(document).on(&quot;click&quot;, &quot;.doc&quot;, function() {
    $(&quot;.selected&quot;).removeClass(&quot;selected&quot;);
    $(&quot;.popover&quot;).hide();
    clickedMarkup = null;

    $(&quot;.justSelected.markup&quot;).removeClass(&quot;justSelected&quot;);
    // $(&quot;.justExtended&quot;).contents().unwrap();
    $(&quot;.justSelected,.justExtended&quot;).contents().unwrap();
});

/**
 * Handles the application cache events. If the application cache is ready for
 * an update, the application cache is swapped and the location is reloaded.
 *
 * @for Global
 * @method handleAppCache
 */
var handleAppCache = function() {
    if (applicationCache === undefined) {
        return;
    }

    if (applicationCache.status == applicationCache.UPDATEREADY) {
        applicationCache.swapCache();
        location.reload();
        return;
    }

    applicationCache.addEventListener(&#x27;updateready&#x27;, handleAppCache, false);
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
