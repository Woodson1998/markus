/*! MARKUS 2019-04-15 */
function fetch(a,b){function c(){d.readyState<4||200===d.status&&4===d.readyState&&b(d)}var d;if("undefined"!=typeof XMLHttpRequest)d=new XMLHttpRequest;else for(var e=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],f=0,g=e.length;f<g;f++)try{d=new ActiveXObject(e[f]);break}catch(a){}d.onreadystatechange=c,d.open("GET",a,!0),d.send("")}importScripts("cssSelectorForWebWorker.browserify.js");var converBackToUnicode=function(a){return a.match(new RegExp("&(?:amp;){0,1}#\\(([^\\)]{1,})\\);","gm"))?a.replace(new RegExp("&(?:amp;){0,1}#\\(([^\\)]{1,})\\);","gm"),function(a,b,c){return String.fromCharCode(b)}):a};self.addEventListener("message",function(a){fetch(a.data,function(a){var b=a.responseText,c=extractTag(b),d=[];c("span.passage").each(function(){var a=c(this).attr("id");c(this).find("span.markup").each(function(b,e){var f=c(this).attr("type"),g=c(this).text(),h=c(this).attr("cbdbid")||c(this).attr(i+"_id")||"",i="string";switch(f){case"fullName":case"partialName":i="person";break;case"timePeriod":i="date"}var j={passageId:a,name:f,type:i,category:"tag",value:g,id:h};d.push(j)}),c(this).find("span.metadataContainer").each(function(b,e){for(var f=JSON.parse(converBackToUnicode(c(this).attr("value").replace(/&quot;/g,'"'))),b=0;b<f.length;b++){var g=f[b],h={passageId:a,name:g.name,type:g.type,category:"metadata",value:g.value,id:g.id};d.push(h)}})}),self.postMessage(JSON.stringify(d))})},!1);